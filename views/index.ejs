<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- META DATA -->
    <!-- Define type of characters used in our website -->
    <meta charset="UTF-8" />
    <!-- Keywords for search engine:  useful when publishing -->
    <meta name="keywords" content="luxury perfumes, premium fragrances, Aloura Egypt, fragrance quiz, designer perfumes, niche scents" />
    <!--  Different devices with different resolutions-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Description displayed in search engine -->
    <meta
      name="description"
      content="Discover luxury fragrances at Aloura Egypt. Premium perfumes, AI-powered fragrance quiz, and exclusive scent collections."
    />
    <title>Aloura - Luxury Fragrances & Perfumes</title>
    <!-- END OF META DATA -->

    <!-- Tab Logo / 'Favicon' -->
    <link
      rel="icon"
      type="image/x-icon"
      href="/img/favicons/rounded-background-favicon.ico"
    />

    <!-- Font Awesome (navbar, footer, modal, chatbot, cart all use it's icons SO MAKE SURE TO LINK IT) -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
      integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <!-- Bootstrap CSS & JS(navbar, footer, modal, cart all use it's functionality SO MAKE SURE TO LINK IT) -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- CSS Links (Connecting the CSS file to this file) -->
    <link rel="stylesheet" href="/css/style.css" />

    <!-- JS Links (Connecting the JS file to this file) -->
    <script src="/js/script.js"></script>

    <!-- User authentication status for scripts -->
    <script>
      window.isUserLoggedIn = <%= user ? 'true' : 'false' %>;
    </script>

    <!-- FLUID EFFECT RELATED -->
    <script src="/js/fluidEffect/jquery.min.js"></script>
    <script src="/js/fluidEffect/fluid.min.js"></script>

    <!-- Intial Scroll When Reloading -->
    <script>
      // Prevent the browser from restoring the scroll position
      if (history.scrollRestoration) {
        history.scrollRestoration = "manual";
      }
      // Scroll to the top of the page on load
      window.onload = function () {
        window.scrollTo(0, 0);
      };
    </script>

    <!-- For indulge your senses font -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Urbanist:ital,wght@0,100..900;1,100..900&display=swap"
      rel="stylesheet"
    />

    <!-- Google fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
      rel="stylesheet"
    />

    <!-- Toastify CSS for notifications -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
  </head>

  <body data-mobile="false">
    <!-- Loader -->
    <%- include('partials/loader.ejs') %>

    <!-- Navbar -->
    <%- include('partials/navbar.ejs') %>

    <!-- Modal -->
    <%- include('partials/modal.ejs') %>

    <!-- Cart -->
    <%- include('partials/cart.ejs') %>

    <!-- Chatbot -->
    <%- include('partials/chatbot.ejs') %>

    <!-- Dark Mode -->
    <%- include('partials/dark-mode.ejs') %>

    <!-- Menu Overlay -->
    <div class="menu-overlay"></div>

    <!-- For Him & For Her Segment -->
    <div class="gender avoid-dark-mode">
      <!--Intialize Container (taking gender CSS container)-->
      <div class="text-overlay-indulge avoid-dark-mode bebas-neue-regular">
        INDULGE
      </div>
      <div class="text-overlay-your avoid-dark-mode bebas-neue-regular">
        YOUR SENSES
      </div>

      <div class="left-container avoid-dark-mode">
        <p>
          &nbsp;DISCOVER CAPTIVATING SCENTS THAT EMBODY<br />
          &nbsp;GRACE, STRENGTH AND ALLURE—CRAFTED FOR<br />
          THE MODERN WOMAN.
        </p>

        <!--Explore Fragrances Button-->
        <button
          class="explore-fragrances explore-fragrances-her"
        >
          Explore Fragrances
        </button>

        <!-- For Her Button -->
        <div class="text-overlay">
          <button
            class="for-her bebas-neue-regular"
            style="z-index: 1"
          >
            For Her
          </button>
        </div>
      </div>

      <div class="right-container avoid-dark-mode">
        <p>
          UNVEIL FRAGRANCES THAT DEFINE<br />
          CONFIDENCE, CHARISMA, AND REFIENMENT— <br />
          CRAFTED FOR THE DISTUNGUISHED MAN.
        </p>

        <!--Explore Fragrances Button-->
        <button
          class="explore-fragrances explore-fragrances-him"
        >
          Explore Fragrances
        </button>

        <!-- For Him Button -->
        <div class="text-overlay">
          <button
            class="for-him bebas-neue-regular"
          >
            For Him
          </button>
        </div>
      </div>

      <div class="female">
        <!-- Mobile Gender Label -->
        <div class="mobile-gender-label">FOR HER</div>
        
        <!-- Canvas for Fluid Effect -->
        <canvas id="female-fluid-canvas"></canvas>

        <!-- Female Image -->
        <img
          id="female-img"
          src="/img/girlTestCopy.jpg"
          srcset="./img/girlTestCopy-480.jpg 480w, ./img/girlTestCopy-800.jpg 800w, ./img/girlTestCopy.jpg 1200w"
          sizes="(max-width: 600px) 480px, (max-width: 900px) 800px, 1200px"
          alt="For Her Fragrances"
        />
      </div>

      <div class="male">
        <!-- Mobile Gender Label -->
        <div class="mobile-gender-label">FOR HIM</div>
        
        <!-- Canvas for Fluid Effect -->
        <canvas id="male-fluid-canvas"></canvas>

        <!-- Male Image -->
        <img
          id="male-img"
          src="/img/guyTestCopy.png"
          srcset="./img/guyTestCopy-480.png 480w, ./img/guyTestCopy-800.png 800w, ./img/guyTestCopy.png 1200w"
          sizes="(max-width: 600px) 480px, (max-width: 900px) 800px, 1200px"
          alt="For Him Fragrances"
        />
      </div>

      <!-- Center Journey Text -->
      <div class="fragrance-quiz-container">
        <div class="fragrance-quiz">
          <a href="" class="urbanist-custom">Choose Your Fragrance Journey</a>
        </div>
      </div>      <!-- Transition Image -->
      <div class="transition-container">
        <div class="transition-img-container">
          <img id="transition-img" src="" alt="Transition Image"  loading="lazy"/>
        </div>
        <div class="fragrance-overlay">
          <div class="fragrance-header">
            <div class="fragrance-title">
              <h2 class="fragrance-name">Loading...</h2>
              <span class="fragrance-type">Parfum</span>
            </div>
            <div class="scroll-buttons">
              <button class="scroll-btn up"><i class="fas fa-chevron-up"></i></button>
              <button class="scroll-btn down"><i class="fas fa-chevron-down"></i></button>
              <button class="scroll-btn rewind-btn" title="Back to Gender Selection"><i class="fas fa-undo-alt"></i></button>
              <button class="switch-gender-btn" title="Switch Gender">
                <i class="fas fa-mars"></i>
              </button>
            </div>
          </div>
          <hr class="divider" />
          <div class="fragrance-details">
            <div class="fragrance-description">
              <p>Loading fragrance details...</p>
            </div>
            <div class="fragrance-notes">
              <div class="note-group">
                <span class="note-label">Top Notes</span>
                <span class="note-text">Loading...</span>
              </div>
              <div class="note-group">
                <span class="note-label">Middle Notes</span>
                <span class="note-text">Loading...</span>
              </div>
              <div class="note-group">
                <span class="note-label">Base Notes</span>
                <span class="note-text">Loading...</span>
              </div>
            </div>
            <button class="buy-button">Buy</button>
          </div>
        </div>
      </div>
    </div>

    <!-- After the gender container -->
    <div class="quality-model-section">
      <div class="quality-assurance">
        <h2>Quality Assurance</h2>
        <p>
          At Aloura, we are committed to excellence in every fragrance we
          create. Each bottle represents our dedication to quality and
          craftsmanship.
        </p>
        <p>
          Our perfumes undergo rigorous testing to ensure they meet the highest
          standards. From ingredient selection to final packaging, every step in
          our process is carefully monitored by our team of expert perfumers.
        </p>
        <p>
          We source only the finest natural and synthetic ingredients from
          trusted suppliers around the world. Our commitment to sustainability
          means we prioritize environmentally responsible practices throughout
          our production process.
        </p>
        <p>
          When you choose Aloura, you're not just buying a fragrance – you're
          experiencing the culmination of artistry, science, and passion.
        </p>
        <a href="/our-story" class="learn-more-btn">Learn More</a>
      </div>

      <div class="model-container avoid-dark-mode">
        <h3>Experience Our Craft</h3>
        <div id="model-viewer"></div>
        <p class="interaction-hint">Click and drag to rotate</p>
      </div>

      <!-- New Reviews Section -->
      <div class="reviews-section">
        <h3 class="reviews-title">Customer Reviews</h3>
        <div class="reviews-container" id="reviews-container">
          <% if (reviews && reviews.length > 0) { %>
            <% reviews.forEach((review, index) => { %>
              <!-- review Card <%= index + 1 %>  debugging -->
              <div class="review-card fading-in" data-index="<%= index %>">
                <div class="review-card-stars">
                  <% for(let i = 1; i <= 5; i++) { %>
                    <% if(i <= review.rating) { %>
                      <i class="fa-solid fa-star"></i>
                    <% } else { %>
                      <i class="fa-regular fa-star"></i>
                    <% } %>
                  <% } %>
                </div>
                <div class="review-card-text">
                  "<%= review.comment %>"
                </div>
                <div class="review-card-footer">
                  <div class="review-card-avatar">
                    <img
                      src="<%= review.user.profilePic || '/uploads/defaultProfilePic.png' %>"
                      alt="<%= review.user.name %>"
                      loading="lazy"
                    />
                  </div>
                  <div class="review-card-info">
                    <p class="review-card-name"><%= review.user.name %></p>
                    <p class="review-card-location"><%= review.fragrance.name %></p>
                  </div>
                </div>
              </div>
            <% }) %>
          <% } else { %>
            <!-- Fallback if no reviews -->
            <div class="review-card fading-in" data-index="0">
              <div class="review-card-stars">
                <i class="fa-solid fa-star"></i>
                <i class="fa-solid fa-star"></i>
                <i class="fa-solid fa-star"></i>
                <i class="fa-solid fa-star"></i>
                <i class="fa-solid fa-star"></i>
              </div>
              <div class="review-card-text">
                "No customer reviews available yet. Be the first to leave a review!"
              </div>
              <div class="review-card-footer">
                <div class="review-card-avatar">
                  <img
                    src="/uploads/defaultProfilePic.png"
                    alt="Aloura Team"
                    loading="lazy"
                  />
                </div>
                <div class="review-card-info">
                  <p class="review-card-name">Aloura Team</p>
                  <p class="review-card-location">Coming Soon</p>
                </div>
              </div>
            </div>
          <% } %>
        </div>

        <div class="reviews-navigation">
          <% if (reviews && reviews.length > 3) { %>
            <% const totalPages = Math.ceil(reviews.length / 3); %>
            <% for(let i = 0; i < totalPages; i++) { %>
              <span class="reviews-nav-dot <%= i === 0 ? 'active' : '' %>" data-index="<%= i %>"></span>
            <% } %>
          <% } else { %>
            <span class="reviews-nav-dot active" data-index="0"></span>
          <% } %>
        </div>
      </div>
    </div>

    <!-- Product Slider Section -->
    <div class="product-slider-section">
      <h2 class="slider-title">SHOP YOUR FAVORITES</h2>
      <div class="product-slider-container">
        <!-- Previous Button -->
        <button class="slider-nav-btn prev-btn">
          <i class="fa-solid fa-chevron-left"></i>
        </button>        <!-- Slider Wrapper -->
        <div class="product-slider-wrapper">
          <!-- Product Slider -->
          <div class="product-slider">
            <% if (sliderFragrances && sliderFragrances.length > 0) { %>
              <% sliderFragrances.forEach((fragrance, index) => { %>
                <div
                  class="product-card <%= index === 0 ? 'active' : '' %>"
                  data-name="<%= fragrance.name %>"
                  data-description="<%= fragrance.tags || 'A captivating fragrance' %>"
                  data-rating="<%= fragrance.rating || 0 %> (<%= Math.floor(Math.random() * 1000) + 100 %>)"
                  data-size="<%= fragrance.sizeOptions.length > 0 ? fragrance.sizeOptions[0].size + 'ml' : 'Various sizes' %>"
                  data-price="EGP<%= fragrance.sizeOptions.length > 0 ? fragrance.sizeOptions[0].price : '0' %>.00"
                  data-fragrance-id="<%= fragrance._id %>"
                >
                  <div class="product-img">
                    <img
                      src="<%= fragrance.image[0] %>"
                      alt="<%= fragrance.name %>"
                      loading="lazy"
                    />
                  </div>
                </div>
              <% }) %>
            <% } else { %>
              <!-- Fallback if no fragrances are marked for slider -->
              <div
                class="product-card active"
                data-name="Coming Soon"
                data-description="New fragrances will be available soon"
                data-rating="0"
                data-size="Various sizes"
                data-price="EGP 0.00"
              >
                <div class="product-img">
                  <img
                    src="/img/logo.png"
                    alt="Coming Soon"
                    style="opacity: 0.5;"
                    loading="lazy"
                  />
                </div>
              </div>
            <% } %>
          </div>
        </div>

        <!-- Next Button -->
        <button class="slider-nav-btn next-btn">
          <i class="fa-solid fa-chevron-right"></i>
        </button>
      </div>      <!-- Product Details Container -->
      <div id="product-details" class="product-details">
        <% if (sliderFragrances && sliderFragrances.length > 0) { %>
          <h3 class="product-name"><%= sliderFragrances[0].name %></h3>
          <p class="product-description">
            <%= sliderFragrances[0].description || 'A captivating fragrance' %>
          </p>
          <div class="product-rating" style="display: none;">
            <span class="rating-score"><%= sliderFragrances[0].rating || 0 %> (<%= Math.floor(Math.random() * 1000) + 100 %>)</span>
            <span class="rating-score">(<%= Math.floor(Math.random() * 1000) + 100 %>)</span>
          </div>
          <div class="product-info" style="display: none">
            <span class="product-size"><%= sliderFragrances[0].sizeOptions.length > 0 ? sliderFragrances[0].sizeOptions[0].size + 'ml' : 'Various sizes' %></span>
            <span class="product-price"><%= sliderFragrances[0].sizeOptions.length > 0 ? sliderFragrances[0].sizeOptions[0].price : '0' %> EGP</span>
          </div>
        <% } else { %>
          <h3 class="product-name">Coming Soon</h3>
          <p class="product-description">New fragrances will be available soon</p>
          <div class="product-rating" style="display: none;">
            <span class="rating-score">0</span>
          </div>
          <div class="product-info">
            <span class="product-size">Various sizes</span>
            <span class="product-price">0.00 EGP</span>
          </div>
        <% } %>
      </div>
    </div>

    <!-- Find Your Scent Section -->
    <div class="find-your-scent-section">
      <h2>Find Your Scent</h2>
      <p>Need some help narrowing down the best clean fragrances for you?</p>
      <p>We've got your covered with our simple quiz.</p>
      <button
        id="findYourScent"
        class="btn btn-link find-scent-btn"
        onclick="window.location.href='fragrance-quiz'"
      >
        Find Your Scent
      </button>

      <!-- Perfume Sequence Section -->
      <div class="perfume-sequence-container">
        <img src="/img/perfumes-transparent/khamrah.png" alt="Bleu de Chanel" loading="lazy"/>
        <img
          src="/img/perfumes-transparent/sauvauge-dior.png"
          alt="Sauvage Dior"
          style="scale: 1.15"
          loading="lazy"
        />
        <img src="/img/perfumes-transparent/ysl.png" alt="Tom Ford Vanilla"  loading="lazy"/>
        <img
          src="/img/perfumes-transparent/versace-eros.png"
          alt="Versace Eros"
          loading="lazy"
        />
        <img
          src="/img/perfumes-transparent/xerjoff-alexandria-2.png"
          alt="Xerjoff Alexandria"
          style="scale: 0.9; padding-bottom: 10px"
          loading="lazy"
        />
        <img
          src="/img/perfumes-transparent/scandal.png"
          alt="Scandal"
          style="scale: 0.9; padding-bottom: 10px"
        />
        <img
          src="/img/perfumes-transparent/burberry-her.png"
          alt="Burberry Her"
          style="scale: 0.8; padding-top: 10px"
          loading="lazy"
        />
        <img
          src="/img/perfumes-transparent/stronger-with-you.png"
          id="stronger-with-you"
          alt="Stronger With You"
          style="scale: 0.9; padding-top: 15px"
          loading="lazy"
        />
      </div>
    </div>

    <!-- Popup Overlay 
      <div class="popup-overlay">
        <div class="popup-container">
          <div class="popup-close">
            <i class="fa-solid fa-times"></i>
          </div>
          <img
            src="/img/ALOURA.jpg"
            alt="Special Offer"
            class="popup-image"
          />
          <button class="popup-btn">REDEEM NOW</button>
        </div>
      </div>
    -->

    <!-- Footer -->
    <%- include('partials/footer.ejs') %>

    <!-- FLUID - Female -->
    <script src="/js/fluidEffect/female-app.js"></script>
    <!-- FLUID - Male -->
    <script src="/js/fluidEffect/male-app.js"></script>

    <!-- Three.js for 3D model viewer -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.js"></script>
    <script src="/js/3dmodel.js"></script>
    <script type="module" src="/js/all-fragrances.js"></script>

    <!-- Fragrance Details Modal (Carousel Pop-up) -->
    <div id="fragrance-modal" class="fragrance-modal-overlay" style="display:none;">
      <div class="fragrance-modal-card fragrance-modal-horizontal">
        <button class="fragrance-modal-close" aria-label="Close">&times;</button>
        <div class="fragrance-modal-img-wrap">
          <img id="fragrance-modal-img" src="<%= sliderFragrances && sliderFragrances.length > 0 ? sliderFragrances[0].image[0] : '' %>" alt="Fragrance Image" loading="lazy"/>
        </div>
        <div class="fragrance-modal-content">
          <div class="fragrance-modal-header">
            <h3 id="fragrance-modal-name"><%= sliderFragrances && sliderFragrances.length > 0 ? sliderFragrances[0].name : '' %></h3>
          </div>
          <div class="fragrance-modal-sizes" id="fragrance-modal-sizes">
            <!-- Size buttons will be injected here -->
          </div>
          <div class="fragrance-modal-price">
            <span id="fragrance-modal-price"></span>
          </div>
          <div class="fragrance-modal-notes">
            <div><strong>Top Notes:</strong> <span id="fragrance-modal-top"></span></div>
            <div><strong>Middle Notes:</strong> <span id="fragrance-modal-middle"></span></div>
            <div><strong>Base Notes:</strong> <span id="fragrance-modal-base"></span></div>
          </div>
          <div class="fragrance-modal-buttons">
            <button id="fragrance-modal-add-to-cart" class="add-to-cart-btn" disabled>Add to Cart</button>
            <% if (!user) { %>
              <button class="add-to-cart-btn gift-btn" data-bs-toggle="modal" data-bs-target="#loginModal">Buy As Gift</button>
            <% } else { %>
              <button class="add-to-cart-btn gift-btn" onclick="window.location.href='/gifting'">Buy As Gift</button>
            <% } %>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
